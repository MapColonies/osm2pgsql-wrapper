{{- $releaseName := .Release.Name -}}
{{- $chartName := include "osm2pgsql-wrapper.name" . -}}
{{- $tracingUrl := include "osm2pgsql-wrapper.tracingUrl" . -}}
{{- if .Values.enabled -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $releaseName }}-{{ $chartName }}-configmap
data:
  {{- with .Values.postgres }}
  PGHOST: {{ .host }}
  PGPORT: {{ .port | default 5432 | quote }}
  PGDATABASE: {{ .database }}
  POSTGRES_ENABLE_SSL_AUTH: {{ .sslAuth.enabled | quote }}
  {{- if .sslAuth.enabled }}
  POSTGRES_CERTS_MOUNT_PATH: {{ .sslAuth.mountPath | quote }}
  {{- end }}
  {{- end }}
  {{- with .Values.s3 }}
  S3_ENDPOINT: {{ printf "%s://%s:%v/" .protocol .host .port | quote }}
  S3_BUCKET_NAME: {{ .bucketName | quote }}
  S3_KEY_ID: {{ .keyId | quote }}
  S3_ACL: {{ .acl | quote | default "public-read" }}
  {{- end }}
  LOG_LEVEL: {{ .Values.env.logLevel | quote }}
  LOG_PRETTY_PRINT_ENABLED: {{ .Values.env.logPrettyPrintEnabled | quote | default "false" }}
  {{ if .Values.env.tracing.enabled }}
  TELEMETRY_TRACING_ENABLED: "true"
  TELEMETRY_TRACING_URL: {{ $tracingUrl }}
  {{- else }}
  TELEMETRY_TRACING_ENABLED: "false"
  {{- end }}
  HTTP_CLIENT_TIMEOUT: {{ .Values.env.httpClient.timeout | quote }}
  COMMAND: {{ .Values.cli.command | quote }}
  {{- if eq .Values.cli.command "append" }}
  CONFIG: {{ printf "%s/%s" .Values.cli.append.config.mountPath .Values.cli.append.config.fileName | quote }}
  REPLICATION_URL: {{ .Values.cli.append.replicationUrl | quote }}
  {{- end }}
  {{- if eq .Values.cli.command "create" }}
  S3_SCRIPT_KEY: {{ .Values.cli.create.s3ScriptKey | quote }}
  DUMP_SERVER_URL: {{ .Values.cli.create.dumpServerUrl | quote }}
  {{- end }}
{{- end -}}
